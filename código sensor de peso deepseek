#include "HX711.h"

// Definição dos pinos
const int LOADCELL_DOUT_PIN = 3;  // Pino DT do HX711
const int LOADCELL_SCK_PIN = 2;   // Pino SCK do HX711

// Inicialização do HX711
HX711 scale;

// Fator de calibração (ajustar durante a calibração)
float calibration_factor = -7050; // Valor negativo para células de carga que comprimem

void setup() {
  Serial.begin(9600);
  Serial.println("Inicializando a balança...");
  
  scale.begin(LOADCELL_DOUT_PIN, LOADCELL_SCK_PIN);
  
  Serial.println("Antes de começar, remova qualquer peso da balança.");
  Serial.println("Após iniciar as leituras, coloque um peso conhecido na balança.");
  Serial.println("Pressione + ou a para aumentar o fator de calibração");
  Serial.println("Pressione - ou z para diminuir o fator de calibração");
  
  scale.set_scale();
  scale.tare(); // Zera a balança
  
  long zero_factor = scale.read_average(); // Lê o valor zerado
  Serial.print("Fator de zero: "); // Deve ser próximo de zero
  Serial.println(zero_factor);
}

void loop() {
  scale.set_scale(calibration_factor); // Ajusta com o fator de calibração
  
  Serial.print("Leitura: ");
  Serial.print(scale.get_units(), 1); // Mostra com 1 casa decimal
  Serial.print(" kg"); // Unidade de medida (ajustar conforme necessidade)
  Serial.print(" Fator de calibração: ");
  Serial.print(calibration_factor);
  Serial.println();
  
  // Ajuste do fator de calibração via serial
  if(Serial.available()) {
    char temp = Serial.read();
    if(temp == '+' || temp == 'a')
      calibration_factor += 10;
    else if(temp == '-' || temp == 'z')
      calibration_factor -= 10;
    else if(temp == 't') // Tare (zerar)
      scale.tare();
  }
  
  delay(500); // Intervalo entre leituras
}
